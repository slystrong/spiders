import requestsimport reimport osheaders={    'Accept':'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',    'Accept-Encoding':'gzip, deflate',    'Accept-Language':'zh-CN,zh;q=0.9',    'Connection':'keep-alive',    'Cookie':'_iuqxldmzr_=32; _ntes_nnid=142ffd9516e00513b9707328c29e0195,1521784704858; _ntes_nuid=142ffd9516e00513b9707328c29e0195; usertrack=ezq0plq3wOMQ34EHmPMAAg==; vjuids=-4fe770c38.1625deef87d.0.c7e007fc37d26; vjlast=1521994365.1521994365.30; vinfo_n_f_l_n3=d203e34a25baf465.1.0.1521994365067.0.1521994373977; __f_=1522052708376; nts_mail_user=71855459@163.com:-1:1; _ngd_tid=TFxsw5HJSdmxG9lcO7BDua0ZOT7ARpKo; P_INFO=71855459@163.com|1522470756|0|urs|11&6|hub&1522470505&mail163#hub&420100#10#0#0|&0|mail163|71855459@163.com; __utma=94650624.264254083.1522676515.1523435577.1523780359.6; __utmc=94650624; __utmz=94650624.1523780359.6.4.utmcsr=baidu|utmccn=(organic)|utmcmd=organic; WM_TID=%2FmmgDsapiTPWLMI1H4dIYKG34eF08h4h; JSESSIONID-WYYY=%2FATUbu32QDzHbV9nv%5CbTU0%2F%5CFDDuUiK2Gtm4R99xZY22R%2FuMxAiTEtqyfoQGXbG%2BOZGlqlt2rbwD8KHq47%2FXTF0P8d%5C7p17iYRMeBBnoNDkPpnyx0tAkck76ZzoODF0y1e8%5CTxUa1vVKZ94mdyUnvUB%2FJyjWAWvug9VcCvh7obm5e02P%3A1523783898525; __utmb=94650624.11.10.1523780359',    'Host':'music.163.com',    'Referer':'http://music.163.com/',    'Upgrade-Insecure-Requests':'1',    'User-Agent':'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.186 Safari/537.36'    }html=requests.get('http://music.163.com/discover/toplist?id=3778678',headers=headers)reg=re.compile(r'<ul class="f-hide">(.*?)</ul>')totalList=reg.findall(html.text)reg=re.compile(r'<a href=./song\?id=(.*?).>.*?</a>')songid=reg.findall(totalList[0])reg=re.compile(r'<a href=./song\?id=.*?.>(.*?)</a>')songname=reg.findall(totalList[0])#http://music.163.com/song/media/outer/url?id=*.mp3songurl=['http://music.163.com/song/media/outer/url?id='+x+'.mp3' for x in songid]rank=1print('获取网易云音乐热歌榜歌名和下载地址\n')if not os.path.exists('topmusic'):      os.mkdir('topmusic')if os.path.exists('歌曲排名和下载地址.txt'):    os.remove('歌曲排名和下载地址.txt')for i,j in zip(songname,songurl):    with open('歌曲排名和下载地址.txt', 'a+',encoding='utf-8') as file:        file.write('排名:{}\n歌名:{}\n下载地址:{}\n\n'.format(rank,i,j))    rank=rank+1print('获取成功,已保存为txt文件到当前目录。\n')YN=input('是否需要下载所有歌曲?y/n\n')if YN == 'y' or YN == 'Y':    rank=1        for i,j in zip(songname,songurl):        print('正在下载第%d首歌曲:\'%s\'\n' % (rank,i))        music=requests.get(j)        if not os.path.exists('topmusic/'+ i +'.mp3'):            try:                  with open('topmusic/'+ i +'.mp3', 'wb') as file:                        file.write(music.content)            except IOError:                  print('第%d首歌曲:\'%s\'下载失败!!!!!!\n' % (rank,i))            else:                  print('第%d首歌曲:\'%s\'下载完毕\n' % (rank,i))        else:            print('第%d首歌曲:\'%s\'已经下载\n' % (rank,i))            rank=rank+1else:    exit(0)    